<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Manage Order - Admin</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
         <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
  <link rel="stylesheet" href="/stylesheet/style.css" />
</head>
<body>
    <%- include('partials/navbar') %><h1>Order History</h1>
<table class="table">
  <thead>
    <tr>
      <th>Order ID</th>
      <th>User</th>
      <th>Status</th>
      <th>Total</th>
      <th>Date</th>
      <th>Payment</th>
      <th>Items</th>
      <th>Action</th>
    </tr>
  </thead>
  <tbody>
    <% orders.forEach(order => { %>
      <tr>
        <td><%= order.order_id %></td>
        <td><%= order.username %> (<%= order.email %>)</td>
        <td><%= order.status %></td>
        <td>$<%= order.final_amount %></td>
        <td><%= order.order_date.toLocaleString() %></td>
        <td><%= order.payment_type ? order.payment_type.charAt(0).toUpperCase() + order.payment_type.slice(1) : 'N/A' %></td>
        <td>
          <ul class="mb-0">
            <% order.items.forEach(item => { %>
              <li><%= item.gear_name %> x <%= item.quantity %> ($<%= item.unit_price %> each)</li>
            <% }) %>
          </ul>
        </td>
        <td>
          <% if(order.payment_status !== 'refunded') { %>
            <form action="/admin/orders/<%= order.order_id %>/refund" method="POST" style="display:inline;">
              <button type="submit" class="btn btn-sm btn-danger">Refund</button>
            </form>
          <% } else { %>
            <span class="text-success">Refunded</span>
          <% } %>
        </td>
      </tr>
    <% }) %>
  </tbody>
</table>

<%- include('partials/footer') %>
</body>
</html>