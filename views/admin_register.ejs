<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Admin - Register User</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="/stylesheet/style.css" />
</head>
<body>
  <%- include('partials/navbar') %>
  
  <main class="container mt-5" style="max-width: 800px;">
    <div class="d-flex justify-content-between align-items-center mb-4">
      <h2>Register New User</h2>
      <a href="/admin/users" class="btn btn-secondary">
        <i class="fas fa-arrow-left me-2"></i>Back to Users
      </a>
    </div>
    
    <% if (errors && errors.length > 0) { %>
      <div class="alert alert-danger">
        <ul class="mb-0">
          <% errors.forEach(error => { %>
            <li><%= error.msg %></li>
          <% }) %>
        </ul>
      </div>
    <% } %>
    
    <div class="card">
      <div class="card-body">
        <form action="/admin/register" method="POST" id="adminRegisterForm">
          <div class="row mb-3">
            <div class="col">
              <label class="form-label">First Name *</label>
              <input type="text" class="form-control" name="first_name" value="<%= formData.first_name || '' %>" required>
            </div>
            <div class="col">
              <label class="form-label">Surname *</label>
              <input type="text" class="form-control" name="surname" value="<%= formData.surname || '' %>" required>
            </div>
          </div>
          
          <div class="row mb-3">
            <div class="col">
              <label class="form-label">E-mail *</label>
              <input type="email" class="form-control" name="email" value="<%= formData.email || '' %>" required>
            </div>
            <div class="col">
              <label class="form-label">Date of Birth *</label>
              <input type="date" class="form-control" name="dob" value="<%= formData.dob || '' %>" required>
              <small class="text-muted">User must be at least 13 years old</small>
            </div>
          </div>
          
          <div class="mb-3">
            <label class="form-label">Username *</label>
            <input type="text" class="form-control" name="username" value="<%= formData.username || '' %>" required>
            <small class="text-muted">3-20 characters, letters, numbers, and underscores only</small>
          </div>
          
          <div class="row mb-3">
            <div class="col">
              <label class="form-label">Password *</label>
              <input type="password" class="form-control" name="password" required>
            </div>
            <div class="col">
              <label class="form-label">Re-enter Password *</label>
              <input type="password" class="form-control" name="confirm_password" required>
            </div>
          </div>
          
          <div class="mb-3">
            <small class="text-muted">
              Password requirements:<br>
              • Is between 8 and 20 characters long<br>
              • Contains upper and lower case letters<br>
              • Contains at least one number and one special character (@$!%*?&)<br>
              • Does not contain the username or email
            </small>
          </div>
          
          <div class="row mb-3">
            <div class="col">
              <label class="form-label">Country *</label>
              <select class="form-select" name="country" required>
                <option value="" disabled <%= !formData.country ? 'selected' : '' %>>Select Country</option>
                <option value="Singapore" <%= formData.country === 'Singapore' ? 'selected' : '' %>>Singapore</option>
                <option value="Malaysia" <%= formData.country === 'Malaysia' ? 'selected' : '' %>>Malaysia</option>
                <option value="Indonesia" <%= formData.country === 'Indonesia' ? 'selected' : '' %>>Indonesia</option>
                <option value="Pakistan" <%= formData.country === 'Pakistan' ? 'selected' : '' %>>Pakistan</option>
                <option value="Other" <%= formData.country === 'Other' ? 'selected' : '' %>>Other</option>
              </select>
            </div>
            <div class="col">
              <label class="form-label">Phone (Optional)</label>
              <input type="tel" class="form-control" name="phone" value="<%= formData.phone || '' %>">
            </div>
          </div>
          
          <div class="mb-3">
            <label class="form-label">User Role *</label>
            <select class="form-select" name="role" required>
              <option value="user" <%= formData.role === 'user' ? 'selected' : '' %>>User</option>
              <option value="admin" <%= formData.role === 'admin' ? 'selected' : '' %>>Administrator</option>
            </select>
          </div>
          
          <div class="d-grid gap-2 d-md-flex justify-content-md-end">
            <a href="/admin/users" class="btn btn-secondary me-md-2">Cancel</a>
            <button type="submit" class="btn btn-success">Register User</button>
          </div>
        </form>
      </div>
    </div>
  </main>
  
  <script>
    // Age validation
    document.getElementById('adminRegisterForm').addEventListener('submit', function(e) {
      const dobInput = document.querySelector('input[name="dob"]');
      const dob = new Date(dobInput.value);
      const today = new Date();
      
      let age = today.getFullYear() - dob.getFullYear();
      const monthDiff = today.getMonth() - dob.getMonth();
      
      if (monthDiff < 0 || (monthDiff === 0 && today.getDate() < dob.getDate())) {
        age--;
      }
      
      if (age < 13) {
        e.preventDefault();
        alert('User must be at least 13 years old to register.');
        return false;
      }
      
      // Password confirmation check
      const password = document.querySelector('input[name="password"]').value;
      const confirmPassword = document.querySelector('input[name="confirm_password"]').value;
      
      if (password !== confirmPassword) {
        e.preventDefault();
        alert('Passwords do not match.');
        return false;
      }
    });
  </script>
  
  <%- include('partials/footer') %>
</body>
</html>