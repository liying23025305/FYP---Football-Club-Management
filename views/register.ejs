<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Register</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
      
  <link rel="stylesheet" href="/stylesheet/style.css" />
</head>
<body>
  <!-- Navbar -->
  <%- include('partials/navbar') %>
  
  <main class="container mt-5" style="max-width: 600px;">
    <h2 class="text-center mb-4">Create an Account</h2>
  
    <% if (errors && errors.length > 0) { %>
      <div class="alert alert-danger">
        <ul class="mb-0">
          <% errors.forEach(error => { %>
            <li><%= error.msg %></li>
          <% }) %>
        </ul>
      </div>
    <% } %>
  
    <form action="/registerAccount" method="POST" id="registerForm">
      <div class="row mb-3">
        <div class="col">
          <label class="form-label">First Name *</label>
          <input type="text" class="form-control" name="first_name" value="<%= formData.first_name || '' %>" required>
        </div>
        <div class="col">
          <label class="form-label">Surname *</label>
          <input type="text" class="form-control" name="surname" value="<%= formData.surname || '' %>" required>
        </div>
      </div>
  
      <div class="row mb-3">
        <div class="col">
          <label class="form-label">E-mail *</label>
          <input type="email" class="form-control" name="email" value="<%= formData.email || '' %>" required>
        </div>
        <div class="col">
          <label class="form-label">Date of Birth *</label>
          <input type="date" class="form-control" name="dob" value="<%= formData.dob || '' %>" required>
          <small class="text-muted">You must be at least 13 years old</small>
        </div>
      </div>
      
      <div class="mb-3">
        <label class="form-label">Username *</label>
        <input type="text" class="form-control" name="username" value="<%= formData.username || '' %>" required>
        <small class="text-muted">3-20 characters, letters, numbers, and underscores only</small>
      </div>

      <div class="row mb-3">
        <div class="col">
          <label class="form-label">Password *</label>
          <input type="password" class="form-control" name="password" required>
        </div>
        <div class="col">
          <label class="form-label">Re-enter Password *</label>
          <input type="password" class="form-control" name="confirm_password" required>
        </div>
      </div>
  
      <div class="mb-3">
        <small class="text-muted">
          For your security please ensure your password:<br>
          • Is between 8 and 20 characters long<br>
          • Contains upper and lower case letters<br>
          • Contains at least one number and one special character (@$!%*?&)<br>
          • Does not contain your username or email
        </small>
      </div>
  
      <div class="row mb-3">
        <div class="col">
          <label class="form-label">Country *</label>
          <select class="form-select" name="country" required>
            <option value="" disabled <%= !formData.country ? 'selected' : '' %>>Select Country</option>
            <option value="Singapore" <%= formData.country === 'Singapore' ? 'selected' : '' %>>Singapore</option>
            <option value="Malaysia" <%= formData.country === 'Malaysia' ? 'selected' : '' %>>Malaysia</option>
            <option value="Indonesia" <%= formData.country === 'Indonesia' ? 'selected' : '' %>>Indonesia</option>
            <option value="Pakistan" <%= formData.country === 'Pakistan' ? 'selected' : '' %>>Pakistan</option>
            <option value="Other" <%= formData.country === 'Other' ? 'selected' : '' %>>Other</option>
          </select>
        </div>
        <div class="col">
          <label class="form-label">Phone (Optional)</label>
          <input type="tel" class="form-control" name="phone" value="<%= formData.phone || '' %>">
        </div>
      </div>
  
      <div class="mb-3">
        <label class="form-label d-block">Do you want to hear about our offers?</label>
        <div class="form-check form-check-inline">
          <input class="form-check-input" type="radio" name="marketing_consent" id="yes" value="yes" <%= formData.marketing_consent === 'yes' ? 'checked' : '' %>>
          <label class="form-check-label" for="yes">Yes</label>
        </div>
        <div class="form-check form-check-inline">
          <input class="form-check-input" type="radio" name="marketing_consent" id="no" value="no" <%= formData.marketing_consent === 'no' ? 'checked' : '' %>>
          <label class="form-check-label" for="no">No</label>
        </div>
      </div>
  
      <div class="d-grid">
        <button type="submit" class="btn btn-dark">Register</button>
      </div>
  
      <p class="mt-3 text-center">Already have an account? <a href="/login">Login here</a></p>
    </form>
  </main>

  <script>
    // Age validation
    document.getElementById('registerForm').addEventListener('submit', function(e) {
      const dobInput = document.querySelector('input[name="dob"]');
      const dob = new Date(dobInput.value);
      const today = new Date();
      
      let age = today.getFullYear() - dob.getFullYear();
      const monthDiff = today.getMonth() - dob.getMonth();
      
      if (monthDiff < 0 || (monthDiff === 0 && today.getDate() < dob.getDate())) {
        age--;
      }
      
      if (age < 13) {
        e.preventDefault();
        alert('You must be at least 13 years old to register.');
        return false;
      }
    });
  </script>
  
</body>
<%- include('partials/footer') %>
</html>